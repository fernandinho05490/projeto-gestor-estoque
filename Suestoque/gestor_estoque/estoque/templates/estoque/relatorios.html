{% extends 'estoque/base.html' %}

{% block title %}Relatórios Avançados{% endblock %}

{% block head_extra %}
<!-- CSS da biblioteca Flatpickr para o seletor de datas -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
{% endblock %}


{% block content %}
<!-- CABEÇALHO DA PÁGINA -->
<div class="mb-5">
    <h1 class="h2 mb-0">Relatórios Avançados</h1>
    <p class="text-secondary">Selecione um período e personalize o conteúdo para gerar um relatório em PDF.</p>
</div>

<!-- CARD DE CONFIGURAÇÃO DO RELATÓRIO -->
<div class="card">
    <div class="card-body p-4 p-md-5">
        <form action="{% url 'exportar_relatorio_pdf' %}" method="get" target="_blank">
            <div class="row g-4">
                <!-- Coluna de Seleção de Período -->
                <div class="col-lg-8">
                    <h3 class="h5 mb-3">1. Selecione o Período</h3>
                    <div class="row">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <label for="start_date" class="form-label text-secondary">Data de Início</label>
                            <input type="text" class="form-control" name="start_date" id="start_date" placeholder="Selecione a data inicial..." required>
                        </div>
                        <div class="col-md-6">
                            <label for="end_date" class="form-label text-secondary">Data de Fim</label>
                            <input type="text" class="form-control" name="end_date" id="end_date" placeholder="Selecione a data final..." required>
                        </div>
                    </div>
                </div>

                <!-- Coluna de Opções de Conteúdo -->
                <div class="col-lg-4">
                    <h3 class="h5 mb-3">2. Personalize o Conteúdo</h3>
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" role="switch" name="incluir_graficos" id="incluir_graficos" checked>
                        <label class="form-check-label" for="incluir_graficos">Incluir Gráficos Visuais</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" name="incluir_ranking" id="incluir_ranking" checked>
                        <label class="form-check-label" for="incluir_ranking">Incluir Ranking de Lucratividade</label>
                    </div>
                </div>
            </div>
            
            <hr class="my-4">

            <!-- Botão de Ação -->
            <div class="text-center">
                <button type="submit" class="btn btn-danger btn-lg rounded-pill px-5 py-2">
                    <i class="bi bi-file-earmark-pdf-fill"></i> Gerar Relatório PDF
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}


{% block scripts_extra %}
<!-- JS da biblioteca Flatpickr -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<!-- JS para traduzir o calendário para Português -->
<script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>

<script>
    // Função para inicializar os seletores de data
    const initFlatpickr = (theme) => {
        const commonOptions = {
            dateFormat: "d/m/Y",
            locale: "pt"
        };
        
        flatpickr("#start_date", commonOptions);
        flatpickr("#end_date", commonOptions);

        // Altera o tema do calendário se o tema do site mudar
        // Adicionamos a classe 'dark' do Flatpickr ao body para carregar o CSS do tema escuro
        if (theme === 'dark') {
            document.body.classList.add('flatpickr-dark');
        } else {
            document.body.classList.remove('flatpickr-dark');
        }
    };

    // Observador para detectar a mudança de tema no site
    const themeObserver = new MutationObserver((mutationsList) => {
        for (const mutation of mutationsList) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
                const newTheme = document.documentElement.getAttribute('data-bs-theme');
                initFlatpickr(newTheme);
            }
        }
    });

    themeObserver.observe(document.documentElement, { attributes: true });

    // Inicializa o Flatpickr com o tema atual ao carregar a página
    document.addEventListener('DOMContentLoaded', () => {
        const currentTheme = document.documentElement.getAttribute('data-bs-theme') || 'dark';
        initFlatpickr(currentTheme);
    });
</script>
{% endblock %}

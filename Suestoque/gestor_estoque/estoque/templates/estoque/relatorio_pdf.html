<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Relatório de Vendas - {{ periodo_titulo }}</title>
    <style>
        /* Importando a fonte Inter para um visual mais limpo */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* Configurações da página (A4) e rodapé com contador */
        @page {
            size: A4;
            margin: 1.8cm;
            @bottom-right {
                content: "Página " counter(page) " de " counter(pages);
                font-family: 'Inter', sans-serif;
                font-size: 9px;
                color: #999;
            }
        }

        /* Estilos gerais do corpo do documento */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: #333;
            font-size: 10px;
            line-height: 1.6;
        }

        /* Cabeçalho principal do relatório */
        .header {
            text-align: center;
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 15px;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 22px;
            font-weight: 600;
            margin: 0;
            color: #111;
        }
        .header p {
            font-size: 12px;
            color: #666;
            margin: 5px 0 0 0;
        }

        /* Títulos das seções */
        h2 {
            font-size: 14px;
            font-weight: 600;
            color: #111;
            margin-top: 35px;
            margin-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 5px;
        }

        /* Layout em grade para os cards de resumo */
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        .summary-card {
            background-color: #f7f7f7;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .summary-card .value {
            font-size: 18px;
            font-weight: 700;
            margin: 0 0 5px 0;
            color: #000;
        }
        .summary-card .label {
            font-size: 10px;
            color: #555;
            margin: 0;
            text-transform: uppercase;
        }

        /* Estilos da tabela principal */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            page-break-inside: avoid; /* Evita que a tabela quebre no meio da página */
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        thead th {
            font-weight: 500;
            color: #666;
            text-transform: uppercase;
            font-size: 9px;
            text-align: left;
        }
        /* Alinhamento perfeito para números */
        .text-right { text-align: right; }
        .text-center { text-align: center; }

        /* Container para os gráficos */
        .chart-container {
            text-align: center;
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        .chart-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
        }

        /* Rodapé com data de geração */
        .footer {
            position: fixed;
            bottom: -40px;
            left: 0;
            font-size: 9px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="footer">
        Gerado pelo Gestor de Estoque em {% now "d/m/Y \à\s H:i" %}
    </div>

    <div class="header">
        <h1>Relatório de Vendas</h1>
        <p>Período de Análise: {{ periodo_titulo }}</p>
    </div>

    <!-- SEÇÃO DE RESUMO -->
    <h2>Resumo do Período</h2>
    <div class="summary-grid">
        <div class="summary-card">
            <p class="value">{{ totais_periodo.quantidade }}</p>
            <p class="label">Unidades Vendidas</p>
        </div>
        <div class="summary-card">
            <p class="value" style="color: #2e7d32;">R$ {{ totais_periodo.faturamento|floatformat:2 }}</p>
            <p class="label">Faturamento</p>
        </div>
        <div class="summary-card">
            <p class="value" style="color: #0071e3;">R$ {{ totais_periodo.lucro|floatformat:2 }}</p>
            <p class="label">Lucro</p>
        </div>
    </div>

    <!-- SEÇÃO CONDICIONAL: GRÁFICOS -->
    {% if incluir_graficos and chart_url %}
    <div class="chart-container">
        <h2>Top 5 Variações Mais Vendidas (Unidades)</h2>
        <img src="{{ chart_url }}" alt="Gráfico de Variações Mais Vendidas">
    </div>
    {% endif %}
    
    <!-- SEÇÃO CONDICIONAL: RANKING DE LUCRATIVIDADE -->
    {% if incluir_ranking and ranking_lucratividade %}
    <h2>Top 5 Variações Mais Lucrativas</h2>
    <table>
        <thead>
            <tr>
                <th>Variação do Produto</th>
                <th class="text-right">Lucro Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in ranking_lucratividade %}
            <tr>
                <td>{{ item.nome_completo }}</td>
                <td class="text-right">R$ {{ item.lucro|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <!-- SEÇÃO PRINCIPAL: VENDAS DETALHADAS -->
    <h2>Vendas Detalhadas por Variação</h2>
    <table>
        <thead>
            <tr>
                <th>Variação do Produto</th>
                <th class="text-center">Qtd. Vendida</th>
                <th class="text-right">Faturamento</th>
                <th class="text-right">Lucro</th>
            </tr>
        </thead>
        <tbody>
            {% for venda in vendas_detalhadas %}
            <tr>
                <td>{{ venda.nome_completo }}</td>
                <td class="text-center">{{ venda.total_quantidade }}</td>
                <td class="text-right">R$ {{ venda.total_faturamento|floatformat:2 }}</td>
                <td class="text-right">R$ {{ venda.total_lucro|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align: center; padding: 20px;">Nenhuma venda registrada neste período.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>

